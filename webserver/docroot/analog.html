<HTML>

<Head>
<Title>Test Meter-Applet</Title>
<script language="Javascript">
<!--
// ============================================ //
// TEST: Meter-Applet                           //
// Ralf Moros                                   //
// moros@sonne.tachemie.uni-leipzig.de          //
// 21.10.1996                                   //
// ===========================================  //
// http://techni.tachemie.uni-leipzig.de/jjar/jappl/meter/ //
// http://techni.tachemie.uni-leipzig.de/       //
// ===========================================  //

// ajax code by 2009 by Hartmut Eilers
// hartmut@eilers.net

var ReloadAnalogTimer;
var req=null;


function pausecomp(millis)
{
var date = new Date();
var curDate = null;

do { curDate = new Date(); }
while(curDate-date < millis);
} 


function Init()
{ 
  // Timer für kontinuierlichen AJAX Zugriff starten
  ReloadAnalogTimer = setInterval("ReadAnalogData()",500);
}

function SetWert(Wert)
{
      var DF= parseFloat(Wert[0]);
      document.M1.SetMeter(DF); 
      DF= parseFloat(Wert[1]);
      document.M2.SetMeter(DF);
      DF= parseFloat(Wert[2]);
      document.M3.SetMeter(DF); 
      DF= parseFloat(Wert[3]);
      document.M4.SetMeter(DF);
      DF= parseFloat(Wert[4]);
      document.M5.SetMeter(DF); 
      DF= parseFloat(Wert[5]);
      document.M6.SetMeter(DF);
      DF= parseFloat(Wert[6]);
      document.M7.SetMeter(DF); 
      DF= parseFloat(Wert[7]);
      document.M8.SetMeter(DF);
}

// Initialisiert Plattformunabhängig den asynchronen Zugriff
function getXMLHttpRequest() {
	var httpReq=null;
	if (window.XMLHttpRequest) {
		httpReq=new XMLHttpRequest();
	} else if (typeof ActiveXObject != "undefined") {
		httpReq=new ActiveXObject("Microsoft.XMLHTTP");
	}
	return httpReq;
}


// Startet den asynchronen read request
function SendRequest(url, handler, param) {	
	req=getXMLHttpRequest();
	if (req) {
		//alert(url);
		req.onreadystatechange = handler;
		req.open("get", url + "?" + param, true);
		req.send(null);
	}
}


// Diese Funktion liest den asynchronen response und aktualiesiert die LEDs auf die
// gelesenen Werte
function PrintAnalogState() {
	// readyState 4 gibt an dass der request beendet wurde
	if (req.readyState ==4 ) {
		// in resonseText ist die Antwort des Servers
		var str=req.responseText;
		//document.getElementById("debug").value = str;
		// remove html tags
		str = str.replace(/<[^<>]+>/g , "");
		// remove leading space
		str = str.replace(/^ /, "");
		var inputs=str.split(" ");
		document.getElementById("debug").value = inputs
		// nu muss hier in einer Loop jeweils die analogen werte an das Applet übergeben werden
		for (i=0;i<8;i++) {
			//if (document.getElementById("iogroup").value-1==i) {
				SetWert(inputs);
				//pausecomp(1000);
			//}
		}
	}
}


// Diese Funktion wird zyklisch getriggert und stösst den asynchronen request zum
// lesen der Eingänge an
function ReadAnalogData()  {
	var IOGroup=document.getElementById("iogroup");
	// Welcher DeviceServer soll benutzt werden ?
	var Host=document.getElementById("Hostname");
	var ReadURL=document.getElementById("ANALOGURL");
	var Adresse;
	Adresse="http://" + Host.value + ReadURL.value;

	if (IOGroup.value != 0 ) {
		SendRequest(Adresse,PrintAnalogState,IOGroup.value);
	}
}




//-->
</script>



</Head>

<Body Background="" BGColor=#F0F0FF Text=#000000 Link=#0000FF VLink=#800080 ALink=#80FFFF onload="Init()">

<center>
 <FORM name="GETWERT" ACTION="" METHOD="GET">
 <TABLE border = 0> 
 <TR>
  <TD> 	<font color=black>Server:Port=http://<input type=text value='localhost:10080' id="Hostname" size=25>
	<font color=black>IO Group: <input type=text  value=0 id="iogroup" size=2 ><br>
	<font color=black>URL to read Analog IN: <input type=text  value='/analog/read.html' id="ANALOGURL" size=40><br>
	<font color=black>Values read from Device:<input type=text value='' id=debug size=30><br>
 </TD>
 </TR>
 </TABLE> 
 </FORM> 
</center>
<BR><BR>


<center>  
<table border=0>
<TR>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M1" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M2" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M3" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M4" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>



</TR>
<TR>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M5" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M6" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M7" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M8" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="0">
 <PARAM NAME=xto      VALUE="400">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>



</TR></table>
<P></P>

</center>



</Body>

</HTML>
