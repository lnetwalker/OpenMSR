<HTML>

<Head>
<Title>Test Meter-Applet</Title>
<script language="Javascript">
<!--
// ============================================ //
// TEST: Meter-Applet                           //
// Ralf Moros                                   //
// moros@sonne.tachemie.uni-leipzig.de          //
// 21.10.1996                                   //
// ===========================================  //
// http://techni.tachemie.uni-leipzig.de/~jar/  //
// http://techni.tachemie.uni-leipzig.de/       //
// ===========================================  //

var ReloadAnalogTimer;
var req=null;

function Init()
{ 
  // Timer für kontinuierlichen AJAX Zugriff starten
  ReloadAnalogTimer = setInterval("ReadAnalogData()",500);
}

function SetWert(Wert)
{
  var DF= parseFloat(Wert);
  document.M1.SetMeter(DF); 
}

// Initialisiert Plattformunabhängig den asynchronen Zugriff
function getXMLHttpRequest() {
	var httpReq=null;
	if (window.XMLHttpRequest) {
		httpReq=new XMLHttpRequest();
	} else if (typeof ActiveXObject != "undefined") {
		httpReq=new ActiveXObject("Microsoft.XMLHTTP");
	}
	return httpReq;
}


// Startet den asynchronen read request
function SendRequest(url, handler, param) {	
	req=getXMLHttpRequest();
	if (req) {
		//alert(url);
		req.onreadystatechange = handler;
		req.open("get", url + "?" + param, true);
		req.send(null);
	}
}


// Diese Funktion liest den asynchronen response und aktualiesiert die LEDs auf die
// gelesenen Werte
function PrintAnalogState() {
	// readyState 4 gibt an dass der request beendet wurde
	if (req.readyState ==4 ) {
		// in resonseText ist die Antwort des Servers
		var str=req.responseText;
		// remove html tags
		str = str.replace(/<[^<>]+>/g , "");
		// remove leading space
		str = str.replace(/^ /, "");
		var inputs=str.split(" ");
		// nu muss hier in einer Loop jeweils die analogen werte an das Applet übergeben werden
		for (i=0;i<8;i++) {
			if (document.getElementById("iogroup").value-1==i) {
				SetWert(inputs[i]);
			}
		}
	}
}


// Diese Funktion wird zyklisch getriggert und stösst den asynchronen request zum
// lesen der Eingänge an
function ReadAnalogData()  {
	var IOGroup=document.getElementById("iogroup");
	// Welcher DeviceServer soll benutzt werden ?
	var Host=document.getElementById("Hostname");
	var ReadURL=document.getElementById("ANALOGURL");
	var Adresse;
	Adresse="http://" + Host.value + ReadURL.value;

	if (IOGroup.value != 0 ) {
		SendRequest(Adresse,PrintAnalogState,IOGroup.value);
	}
}




//-->
</script>



</Head>

<Body Background="" BGColor=#FFFFFF Text=#000000 Link=#0000FF VLink=#800080 ALink=#80FFFF onload="Init()">

<center>
 <FORM name="GETWERT" ACTION="" METHOD="GET">
 <TABLE border = 0> 
 <TR>
  <TD> 	<font color=white>Server:Port=http://<input type=text value='localhost:10080' id="Hostname" size=25>
	<font color=white>IO Group: <input type=text  value=0 id="iogroup" size=2 ><br>
	<font color=white>URL to read LED: <input type=text  value='/analog/read.html' id="ANALOGURL" size=40><br>
 </TD>
 </TR>
 </TABLE> 
 </FORM> 
</center>
<BR><BR>


<center>  
<table border=0>
<TR>
 <TD align=middle>
 <APPLET CODE="Meter.class" NAME="M1" WIDTH=200 HEIGHT=180>
 <PARAM NAME=header   VALUE="Temperature">
 <PARAM NAME=unit     VALUE="C">
 <PARAM NAME=digital  VALUE="true">
 <PARAM NAME=analog   VALUE="true">
 <PARAM NAME=xfrom    VALUE="-1000">
 <PARAM NAME=xto      VALUE="1000">
 <PARAM NAME=x        VALUE="250.0">  
 </APPLET>
 </TD>



</TR>
</table>
<P></P>

</center>



</Body>

</HTML>
