<HTML>

<Head>
<Title>Test Meter-Applet</Title>
<script language="Javascript">
<!--
// ============================================ //
// TEST: Meter-Applet                           //
// Ralf Moros                                   //
// moros@sonne.tachemie.uni-leipzig.de          //
// 21.10.1996                                   //
// ===========================================  //
// http://techni.tachemie.uni-leipzig.de/jjar/jappl/meter/ //
// http://techni.tachemie.uni-leipzig.de/       //
// ===========================================  //

// ajax code by 2009 by Hartmut Eilers
// hartmut@eilers.net

var ReloadAnalogTimer;
var req=null;


function pausecomp(millis)
{
var date = new Date();
var curDate = null;

do { curDate = new Date(); }
while(curDate-date < millis);
} 


function Init()
{ 
  // Timer für kontinuierlichen AJAX Zugriff starten
  ReloadAnalogTimer = setInterval("ReadAnalogData()",500);
}


// Initialisiert Plattformunabhängig den asynchronen Zugriff
function getXMLHttpRequest() {
	var httpReq=null;
	if (window.XMLHttpRequest) {
		httpReq=new XMLHttpRequest();
	} else if (typeof ActiveXObject != "undefined") {
		httpReq=new ActiveXObject("Microsoft.XMLHTTP");
	}
	return httpReq;
}


// Startet den asynchronen read request
function SendRequest(url, handler, param) {	
	req=getXMLHttpRequest();
	if (req) {
		//alert(url);
		req.onreadystatechange = handler;
		req.open("get", url + "?" + param, true);
		req.send(null);
	}
}


// Diese Funktion liest den asynchronen response und aktualiesiert die LEDs auf die
// gelesenen Werte
function PrintAnalogState() {
	// readyState 4 gibt an dass der request beendet wurde
	if (req.readyState ==4 ) {
		// in resonseText ist die Antwort des Servers
		var str=req.responseText;
		//document.getElementById("debug").value = str;
		// remove html tags
		str = str.replace(/<[^<>]+>/g , "");
		// remove leading space
		str = str.replace(/^ /, "");
		var inputs=str.split(" ");
		document.getElementById("debug").value = inputs
	}
}


// Diese Funktion wird zyklisch getriggert und stösst den asynchronen request zum
// lesen der Eingänge an
function ReadAnalogData()  {
	var IOGroup=document.getElementById("iogroup");
	// Welcher DeviceServer soll benutzt werden ?
	var Host=document.getElementById("Hostname");
	var ReadURL=document.getElementById("ANALOGURL");
	Host.value='dorffer.eilers.net';
	ReadURL.value='/homecontrol/analog/read.html';
	IOGroup.value='1';
	var Adresse;
	Adresse="https://" + Host.value + ReadURL.value;

	if (IOGroup.value != 0 ) {
		SendRequest(Adresse,PrintAnalogState,IOGroup.value);
	}
}




//-->
</script>



</Head>

<Body Background="" BGColor=#F0F0FF Text=#000000 Link=#0000FF VLink=#800080 ALink=#80FFFF onload="Init()">

<center>
 <FORM name="GETWERT" ACTION="" METHOD="GET">
 <TABLE border = 0> 
 <TR>
  <TD> 	<input type=hidden value='localhost:10080' id="Hostname" size=25 >
	<input type=hidden  value=0 id="iogroup" size=2 >
	<input type=hidden  value='/analog/read.html' id="ANALOGURL" size=40 >
	<font color=black>Values read from Device:<input type=text value='' id=debug size=30><br>
 </TD>
 </TR>
 </TABLE> 
 </FORM> 
</center>
<BR><BR>


</Body>

</HTML>
